# Implementation Plan

- [-] 1. 環境のクリーンアップと新ブランチの作成



  - [ ] 1.1 新しいブランチの作成
    - `git checkout -b feature/uncharted-territory-redesign` でブランチを作成
    - 既存の実装からの完全な作り直しのため新ブランチで開始
    - _Requirements: プロジェクト管理_
  
  - [ ] 1.2 既存コードの削除とクリーンアップ
    - frontend/src内の既存コードを全削除
    - backend/src内の既存コードを全削除
    - package.jsonの依存関係を必要最小限にリセット
    - _Requirements: プロジェクト管理_
  
  - [ ] 1.3 Git履歴の整理
    - 削除作業をコミット
    - 新しい実装の開始点として明確にマーク
    - _Requirements: プロジェクト管理_

- [ ] 2. プロジェクト構造とコア型定義の設定
  - [ ] 2.1 モノレポ構造の設定
    - frontend/backendディレクトリ構造の整理
    - 共通設定ファイルの作成
    - _Requirements: 1.1, 1.2_
  
  - [ ] 2.2 コア型定義の作成
    - TypeScript型定義ファイルの作成（GameState、Ship、Station等）
    - 基本的なインターフェースの定義
    - _Requirements: 1.1, 1.2_-
 [ ] 3. データベーススキーマとSupabase設定
  - [ ] 3.1 Supabaseプロジェクトの初期設定
    - Supabaseプロジェクトの作成と設定
    - 環境変数の設定
    - _Requirements: 7.1, 7.2_
  
  - [ ] 3.2 データベーススキーマの実装
    - players、ships、sectors、stations、game_statesテーブルの作成
    - インデックスと制約の設定
    - _Requirements: 7.1, 7.4_
  
  - [ ] 3.3 初期データの投入
    - 初期セクター（Neter）とステーションデータの作成
    - 商品カテゴリと基準価格の設定
    - _Requirements: 1.1, 4.2, 4.3_

- [ ] 4. 基本的なフロントエンド構造の実装
  - [ ] 4.1 React + Viteプロジェクトの設定
    - Viteプロジェクトの初期化
    - TypeScript設定とESLint設定
    - _Requirements: 5.1_
  
  - [ ] 4.2 基本的なUI レイアウトの実装
    - 中央マップエリア、左パネル、右パネルのレイアウト
    - フローティングウィンドウの基本機能
    - _Requirements: 5.1, 5.4, 5.5_
  
  - [ ] 4.3 Canvas描画システムの基礎実装
    - Canvas要素の設定とマウス操作（ズーム、パン）
    - 基本的な描画ループの実装
    - _Requirements: 5.2, 5.3_

- [ ] 5. Cloudflare Workers APIの実装
  - [ ] 5.1 基本的なREST APIエンドポイントの作成
    - プレイヤー認証エンドポイント
    - 船の購入・売却エンドポイント
    - _Requirements: 6.4, 8.4_
  
  - [ ] 5.2 Cloudflare認証の統合
    - 認証ミドルウェアの実装
    - プレイヤーIDの管理
    - _Requirements: 7.3_-
 [ ] 6. ゲーム状態管理システムの実装
  - [ ] 6.1 GameStateクラスの実装
    - ゲーム状態の読み込み・保存機能
    - プレイヤー初期化処理
    - _Requirements: 1.1, 7.1, 7.4_
  
  - [ ] 6.2 Ship管理システムの実装
    - 船の作成・削除・更新機能
    - 船の位置と状態の管理
    - _Requirements: 1.4, 2.1_

- [ ] 7. 経済システムの実装
  - [ ] 7.1 Station生産・消費システムの実装
    - 各ステーションタイプの生産ロジック
    - 60秒サイクルでの生産・消費処理
    - _Requirements: 4.1, 4.2, 4.3, 4.5_
  
  - [ ] 7.2 価格変動システムの実装
    - S字カーブに基づく価格計算
    - 商品カテゴリ別の価格弾力性の実装
    - _Requirements: 3.2, 3.3, 3.4, 3.5_
  
  - [ ] 7.3 在庫管理システムの実装
    - ステーション在庫の更新処理
    - 在庫不足時の生産スキップ処理
    - _Requirements: 3.1, 4.1_

- [ ] 8. 交易AIシステムの実装
  - [ ] 8.1 基本的な交易AI アルゴリズムの実装
    - 航路発見フェーズの実装
    - 期待利益計算ロジック
    - _Requirements: 8.2_
  
  - [ ] 8.2 AI個性システムの実装
    - AIPersonalityクラスの実装
    - 重み付け係数による評価の差別化
    - _Requirements: 8.2_
  
  - [ ] 8.3 航路割り当てシステムの実装
    - 群衆行動回避のための分散アルゴリズム
    - 最低利益額フィルタリング
    - _Requirements: 8.1, 8.3_- [ ] 9. 
Cloudflare Workflowsゲームシミュレーションの実装
  - [ ] 9.1 Workflowの基本構造実装
    - GameSimulationWorkflowクラスの作成
    - 1秒間隔での実行スケジュール設定
    - _Requirements: 6.2_
  
  - [ ] 9.2 経済シミュレーション統合
    - 生産・消費・価格更新の統合実行
    - 全プレイヤーの交易AI実行
    - _Requirements: 4.1, 8.2_
  
  - [ ] 9.3 船の移動とルート実行
    - 船の位置更新処理
    - 交易ルートの実行と完了処理
    - _Requirements: 1.2, 1.3_

- [ ] 10. Supabase Realtimeとクライアント側補間の実装
  - [ ] 10.1 Supabase Realtime接続の実装
    - リアルタイム購読の設定
    - 状態更新の受信処理
    - _Requirements: 6.1, 6.3_
  
  - [ ] 10.2 クライアント側補間システムの実装
    - GameStateInterpolatorクラスの実装
    - 30Hzでの滑らかな描画更新
    - _Requirements: 6.3_
  
  - [ ] 10.3 予測的な船の移動表示
    - 船の移動ルートに基づく予測補間
    - 即座のUIフィードバック実装
    - _Requirements: 1.4_

- [ ] 11. UI機能の実装
  - [ ] 11.1 マップ描画とインタラクションの実装
    - セクター、ステーション、船の描画
    - クリック選択とホバー効果
    - _Requirements: 5.1, 5.2, 5.3_
  
  - [ ] 11.2 情報パネルの実装
    - 船団リストと詳細表示
    - ステーション情報と在庫表示
    - _Requirements: 5.4, 5.5, 3.1_
  
  - [ ] 11.3 経済可視化機能の実装
    - 価格ヒートマップ表示
    - サプライチェーン可視化
    - _Requirements: 3.6, 3.7_-
 [ ] 12. プレイヤーアクション機能の実装
  - [ ] 12.1 船の購入・売却機能
    - 造船所での船購入UI
    - 船売却の確認ダイアログ
    - _Requirements: 2.1_
  
  - [ ] 12.2 交易AI設定機能
    - 最低利益額設定UI
    - AI ON/OFF切り替え機能
    - _Requirements: 8.1, 8.4_

- [ ] 13. テストとデバッグ機能の実装
  - [ ] 13.1 基本的な単体テストの作成
    - 交易AIアルゴリズムのテスト
    - 価格計算ロジックのテスト
    - _Requirements: 8.2, 3.2_
  
  - [ ] 13.2 統合テストの実装
    - ゲーム全体のフロー確認
    - リアルタイム同期のテスト
    - _Requirements: 6.1, 6.3_
  
  - [ ] 13.3 デバッグ用ツールの実装
    - ゲーム状態の可視化ツール
    - 経済データの監視ダッシュボード
    - _Requirements: 3.1, 4.1_

- [ ] 14. 最終統合とデプロイ準備
  - [ ] 14.1 全システムの統合テスト
    - フロントエンドとバックエンドの連携確認
    - パフォーマンステスト
    - _Requirements: 6.1, 6.2, 6.3_
  
  - [ ] 14.2 デプロイ設定の実装
    - Cloudflare Workflowsのデプロイ設定
    - フロントエンドのビルドとデプロイ設定
    - _Requirements: 7.1, 7.2_
  
  - [ ] 14.3 初期ゲームバランスの調整
    - 商品価格と生産量の調整
    - 交易AIの動作確認と調整
    - _Requirements: 3.2, 8.2_