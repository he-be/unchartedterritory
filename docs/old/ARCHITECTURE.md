# Uncharted Territory - アーキテクチャ設計書

## 1. システム概要

宇宙経済シミュレーションゲーム「Uncharted Territory」のMVP版アーキテクチャ。

### 1.1 設計思想
- **探索→交易→拡張**の基本ゲームループ
- **リアルタイム経済**（価格変動・生産サイクル）
- **モジュラー設計**（各システムの独立性確保）
- **API-First**（フロントエンド分離可能）

### 1.2 技術スタック
```
Frontend: 将来実装（React想定）
API Layer: Express.js + Cloudflare Workers
Game Logic: TypeScript Classes
Data: In-memory (将来はDB)
Testing: Vitest + Supertest
```

### 1.3 ディレクトリ構成
```
src/
├── types.ts              # 共通データ型定義
├── world-generator.ts     # 宇宙・セクター生成
├── economic-engine.ts     # 経済システム
├── ship-engine.ts         # 船舶・移動システム
├── index.ts              # Express APIサーバー
├── worker.ts             # Cloudflare Workers
└── __tests__/            # テストスイート
```

## 2. アーキテクチャ図

```
┌─────────────────┐    ┌─────────────────┐
│   Frontend      │    │  Cloudflare     │
│   (Future)      │◄───┤  Workers API    │
└─────────────────┘    └─────────────────┘
                                │
┌─────────────────┐             │
│   Express API   │◄────────────┘
│   Server        │
└─────────────────┘
         │
┌─────────────────┐
│  Game Engine    │
│                 │
│ ┌─────────────┐ │
│ │World Gen    │ │
│ └─────────────┘ │
│ ┌─────────────┐ │
│ │Economic Eng.│ │
│ └─────────────┘ │
│ ┌─────────────┐ │
│ │Ship Engine  │ │
│ └─────────────┘ │
└─────────────────┘
```

## 3. データフロー

1. **初期化**: `world-generator` → 宇宙構造生成
2. **ゲームループ**: 
   - `economic-engine` → 価格更新・生産処理
   - `ship-engine` → 船舶移動・コマンド実行
3. **API層**: ゲーム状態の取得・操作エンドポイント

## 4. 設計原則

### 4.1 単一責任原則
- 各エンジンは明確な責務を持つ
- APIレイヤーはビジネスロジックを含まない

### 4.2 依存関係の制御
- 上位レイヤーが下位レイヤーに依存
- 循環依存を避ける

### 4.3 拡張性
- 新機能追加時の影響範囲を最小化
- インターフェース設計による疎結合

## 5. パフォーマンス考慮点

- **メモリ効率**: ゲーム状態のメモリ管理
- **計算効率**: 価格計算・移動計算の最適化
- **スケーラビリティ**: 複数ゲーム同時実行対応

## 6. 今後の拡張ポイント

- **永続化**: データベース導入
- **リアルタイム**: WebSocket対応
- **自動化**: AI船舶システム
- **マルチプレイヤー**: 複数プレイヤー対応